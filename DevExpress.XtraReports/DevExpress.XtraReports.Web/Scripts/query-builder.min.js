/*! DevExpress HTML/JS Designer - v15.2.2 - 2015-12-01
* http://www.devexpress.com
* Copyright (c) 2015 Developer Express Inc; Licensed Commercial */

var DevExpress;!function(a){var b;!function(b){var c;!function(c){c.name={propertyName:"name",modelName:"@Name",displayName:"Name",editor:a.JS.Widgets.editorTemplates.text,validationRules:b.nameValidationRules},c.text={propertyName:"text",modelName:"@Text",displayName:"Text",editor:a.JS.Widgets.editorTemplates.text},c.size={propertyName:"size",modelName:"@Size",defaultVal:"100,50",from:b.Size.fromString,displayName:"Size",editor:a.JS.Widgets.editorTemplates.objecteditor},c.location={propertyName:"location",modelName:"@Location",from:b.Point.fromString,displayName:"Location",editor:a.JS.Widgets.editorTemplates.objecteditor},c.sizeLocation=[c.size,c.location],c.unknownSerializationsInfo=[c.name].concat(c.sizeLocation)}(c=b.Diagram||(b.Diagram={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},DevExpress;!function(a){var b;!function(b){var c;!function(c){var d=function(a){function b(b,c,d){a.call(this,b,c,d)}return __extends(b,a),b.prototype.getControlFactory=function(){return c.controlsFactory},b}(b.ElementViewModel);c.DiagramElementBaseViewModel=d;var e=function(a){function b(c,d,e){a.call(this,c,d,$.extend({},b._unitProperties,e)),this.template="dx-diagram-element",this.selectiontemplate="dx-diagram-element-selection",this.contenttemplate="dx-diagram-element-content",this.isSnapTarget=!0,this.margin=ko.observable(0)}return __extends(b,a),b._unitProperties={_height:function(a){return a.size.height},_width:function(a){return a.size.width},_x:function(a){return a.location.x},_y:function(a){return a.location.y}},b}(b.SurfaceElementBase);c.DiagramElementBaseSurface=e,c.diagramElementSerializationInfo=[c.size,c.location,c.name,c.text,{propertyName:"type",modelName:"@Type"}];var f=function(b){function c(c,d,e){var f=this;b.call(this,$.extend({"@ControlType":"DiagramElement"},c),d,e),this.connectingPoints=a.JS.Utils.deserializeArray(c&&c.ConnectingPoints||[],function(a){return new h(a,f,e)}),void 0===this.text()&&this.text(this.name())}return __extends(c,b),c}(d);c.DiagramElementViewModel=f;var g=function(a){function b(b,c){a.call(this,b,c,null),this.contenttemplate="dxdd-element-content-with-connecting-points"}return __extends(b,a),b.prototype._getChildrenHolderName=function(){return"connectingPoints"},b}(e);c.DiagramElementSurface=g;var h=function(a){function c(c,d,e){var f=this;a.call(this,$.extend({"@ControlType":"ConnectingPoint"},c),d,e),this.side=ko.pureComputed(function(){return f.percentOffsetY()>=f.percentOffsetX()?f.percentOffsetY()>1-f.percentOffsetX()?1:3:f.percentOffsetY()>1-f.percentOffsetX()?0:2}),this.size=new b.Size(7,7),this.location=new b.Point(0,0),this.location.x=ko.pureComputed(function(){var a=f.parentModel();return a.location.x()+a.size.width()*f.percentOffsetX()}),this.location.y=ko.pureComputed(function(){var a=f.parentModel();return a.location.y()+a.size.height()*f.percentOffsetY()})}return __extends(c,a),c}(d);c.ConnectingPointViewModel=h,c.connectingPointSerializationInfo=[{propertyName:"percentOffsetX",modelName:"@PercentOffsetX",defaultVal:.5,from:b.floatFromModel},{propertyName:"percentOffsetY",modelName:"@PercentOffsetY",defaultVal:.5,from:b.floatFromModel}];var i=function(a){function b(c,d){a.call(this,c,d,b._unitProperties),this.template="dxdd-connecting-point",this.selectiontemplate="dxdd-connection-point-selection",this.contenttemplate=""}return __extends(b,a),b._unitProperties={_x:function(a){return ko.pureComputed(function(){return a.location.x()-a.parentModel().location.x()})},_y:function(a){return ko.pureComputed(function(){return a.location.y()-a.parentModel().location.y()})}},b}(e);c.ConnectingPointSurface=i}(c=b.Diagram||(b.Diagram={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(a){var b;!function(b){function c(a,c){var d={start:null,end:null};if(c.leftConnectionPoint.location.x()>a.rightConnectionPoint.location.x()+2*b.RoutedConnectorViewModel.GRID_SIZE)d.start=a.rightConnectionPoint,d.end=c.leftConnectionPoint;else if(a.leftConnectionPoint.location.x()>c.rightConnectionPoint.location.x()+2*b.RoutedConnectorViewModel.GRID_SIZE)d.start=a.leftConnectionPoint,d.end=c.rightConnectionPoint;else{var e=(a.rightConnectionPoint.location.x()+a.rightConnectionPoint.location.x())/2,f=(c.rightConnectionPoint.location.x()+c.rightConnectionPoint.location.x())/2;e>f?(d.start=a.rightConnectionPoint,d.end=c.rightConnectionPoint):(d.start=a.leftConnectionPoint,d.end=c.leftConnectionPoint)}return d}var d=function(a){function b(b,c,d){var e=this;a.call(this,$.extend(b,{"@ControlType":"ConnectionPoint"}),c,d);var f=this.location.x,g=this.location.y;this.location.x=ko.pureComputed({read:function(){return e.connectingPoint()&&e.connectingPoint().location.x()||f()},write:function(a){e.connectingPoint(null),f(a)}}),this.location.y=ko.pureComputed({read:function(){return e.connectingPoint()&&e.connectingPoint().location.y()||g()},write:function(a){e.connectingPoint(null),g(a)}})}return __extends(b,a),b}(b.DiagramElementBaseViewModel);b.ConnectionPointViewModel=d,b.connectionPointSerializationInfo=[b.location,{propertyName:"connectingPoint",modelName:"@ConnectingPoint",link:!0}];var e=function(a){function b(c,d){var e=this;a.call(this,c,d,b._unitProperties),this.template="dx-diagram-connection-point",this.selectiontemplate="dx-diagram-connection-point",this.relativeX=ko.pureComputed(function(){return e.rect().left-e.parent.rect().left}),this.relativeY=ko.pureComputed(function(){return e.rect().top-e.parent.rect().top})}return __extends(b,a),b._unitProperties={_x:function(a){return a.location.x},_y:function(a){return a.location.y}},b}(a.SurfaceElementBase);b.ConnectionPointSurface=e;var f=function(b){function c(c,e,f){var g=this;b.call(this,$.extend({"@ControlType":"Connector"},c),e,f),this.startPoint(this.startPoint()||new d({"@Location":"0, 0"},this,f)),this.endPoint(this.endPoint()||new d({"@Location":"150, 75"},this,f)),this.location=new a.Point(0,0),this.location.x=ko.pureComputed({read:function(){return g.getX()},write:function(a){var b=g.startPoint().location.x()<g.endPoint().location.x()?g.startPoint().location.x():g.endPoint().location.x(),c=a-b;g.startPoint().location.x(g.startPoint().location.x()+c),g.endPoint().location.x(g.endPoint().location.x()+c)}}),this.location.y=ko.pureComputed({read:function(){return g.getY()},write:function(a){var b=g.startPoint().location.y()<g.endPoint().location.y()?g.startPoint().location.y():g.endPoint().location.y(),c=a-b;g.startPoint().location.y(g.startPoint().location.y()+c),g.endPoint().location.y(g.endPoint().location.y()+c)}}),this.size=new a.Size(0,0),this.size.width=ko.pureComputed({read:function(){return g.getWidth()},write:function(a){g.startPoint().location.x()<g.endPoint().location.x()?g.endPoint().location.x(g.startPoint().location.x()+a):g.startPoint().location.x(g.endPoint().location.x()+a)}}),this.size.height=ko.pureComputed({read:function(){return g.getHeight()},write:function(a){g.startPoint().location.y()<g.endPoint().location.y()?g.endPoint().location.y(g.startPoint().location.y()+a):g.startPoint().location.y(g.endPoint().location.y()+a)}})}return __extends(c,b),c.prototype.getX=function(){return this.startPoint().location.x()<this.endPoint().location.x()?this.startPoint().location.x():this.endPoint().location.x()},c.prototype.getY=function(){return this.startPoint().location.y()<this.endPoint().location.y()?this.startPoint().location.y():this.endPoint().location.y()},c.prototype.getWidth=function(){return Math.abs(this.startPoint().location.x()-this.endPoint().location.x())||c.MIN_LINE_THICKNESS},c.prototype.getHeight=function(){return Math.abs(this.startPoint().location.y()-this.endPoint().location.y())||c.MIN_LINE_THICKNESS},c.MIN_LINE_THICKNESS=3,c}(b.DiagramElementBaseViewModel);b.ConnectorViewModel=f;var g=function(a){function b(b,c){a.call(this,b,c,null),this.template="dxdd-connector",this.selectiontemplate="dxdd-connector-selection",this.startPoint=ko.pureComputed(function(){return new e(b.startPoint(),c)}),this.endPoint=ko.pureComputed(function(){return new e(b.endPoint(),c)})}return __extends(b,a),b}(b.DiagramElementBaseSurface);b.ConnectorSurface=g,function(a){a[a.East=0]="East",a[a.South=1]="South",a[a.North=2]="North",a[a.West=3]="West"}(b.PointSide||(b.PointSide={}));b.PointSide;b.determineConnectingPoints=c;var h=function(b){function c(c,d,e){var f=this;b.call(this,$.extend({"@ControlType":"RoutedConnector"},c),d,e),this._isUpdating=!1,this.routePoints=ko.observable([]),this.freezeRoute=ko.observable(!1),this._disposables.push(ko.computed(function(){var a=!(1+f.startPoint().location.x()+f.startPoint().location.y()+f.endPoint().location.x()+f.endPoint().location.y());f._isUpdating||f.freezeRoute(a)})),this._disposables.push(ko.computed(function(){if(!f.freezeRoute()){var b=[],c=f._getStartPointSide(),d=f._getEndPointSide(),e=new a.Point(f.startPoint().location.x(),f.startPoint().location.y()),g=new a.Point(f.endPoint().location.x(),f.endPoint().location.y());f.startPoint().connectingPoint()&&(f._fixPoint(e,f.startPoint().connectingPoint().side()),b.push(e)),f.endPoint().connectingPoint()&&f._fixPoint(g,f.endPoint().connectingPoint().side());var h=Math.min(e.x(),g.x()),i=Math.min(e.y(),g.y()),j=Math.abs(e.x()-g.x()),k=Math.abs(e.y()-g.y());e.y()-g.y()>0?e.x()-g.x()>0?2===c||0===c?2===d||0===d?b.push(new a.Point(h+j,i)):(b.push(new a.Point(h+j,i+k/2)),b.push(new a.Point(h,i+k/2))):1===d||3===d?b.push(new a.Point(h,i+k)):(b.push(new a.Point(h+j/2,i+k)),b.push(new a.Point(h+j/2,i))):2===c||3===c?2===d||3===d?b.push(new a.Point(h,i)):(b.push(new a.Point(h,i+k/2)),b.push(new a.Point(h+j,i+k/2))):1===d||0===d?b.push(new a.Point(h+j,i+k)):(b.push(new a.Point(h+j/2,i+k)),b.push(new a.Point(h+j/2,i))):e.x()-g.x()>0?1===c||0===c?1===d||0===d?b.push(new a.Point(h+j,i+k)):(b.push(new a.Point(h+j,i+k/2)),b.push(new a.Point(h,i+k/2))):2===d||3===d?b.push(new a.Point(h,i)):(b.push(new a.Point(h+j/2,i)),b.push(new a.Point(h+j/2,i+k))):1===c||3===c?1===d||3===d?b.push(new a.Point(h,i+k)):(b.push(new a.Point(h,i+k/2)),b.push(new a.Point(h+j,i+k/2))):2===d||0===d?b.push(new a.Point(h+j,i)):(b.push(new a.Point(h+j/2,i)),b.push(new a.Point(h+j/2,i+k))),f.endPoint().connectingPoint()&&b.push(g),f.routePoints(b)}}))}return __extends(c,b),c.prototype.getX=function(){var a=b.prototype.getX.call(this);return this.routePoints&&this.routePoints().forEach(function(b){b.x()<a&&(a=b.x())}),a},c.prototype.getY=function(){var a=b.prototype.getY.call(this);return this.routePoints&&this.routePoints().forEach(function(b){b.y()<a&&(a=b.y())}),a},c.prototype.getWidth=function(){var a=b.prototype.getWidth.call(this),c=this.getX();return this.routePoints&&[this.startPoint().location,this.endPoint().location].concat(this.routePoints()).forEach(function(b){b.x()-c>a&&(a=b.x()-c)}),a},c.prototype.getHeight=function(){var a=b.prototype.getHeight.call(this),c=this.getY();return this.routePoints&&[this.startPoint().location,this.endPoint().location].concat(this.routePoints()).forEach(function(b){b.y()-c>a&&(a=b.y()-c)}),a},c.prototype._fixPoint=function(a,b){switch(b){case 2:a.y(a.y()-c.GRID_SIZE);break;case 0:a.x(a.x()+c.GRID_SIZE);break;case 3:a.x(a.x()-c.GRID_SIZE);break;case 1:a.y(a.y()+c.GRID_SIZE)}},c.prototype._getStartPointSide=function(){return this.startPoint().connectingPoint()?this.startPoint().connectingPoint().side():this.startPoint().location.y()!==this.endPoint().location.y()?this.startPoint().location.y()>this.endPoint().location.y()?2:1:this.startPoint().location.x()>this.endPoint().location.x()?3:0},c.prototype._getEndPointSide=function(){return this.endPoint().connectingPoint()?this.endPoint().connectingPoint().side():this.startPoint().location.y()!==this.endPoint().location.y()?this.startPoint().location.y()>this.endPoint().location.y()?1:2:this.startPoint().location.x()>this.endPoint().location.x()?0:3},c.prototype.beginUpdate=function(){this._isUpdating=!0},c.prototype.endUpdate=function(){this._isUpdating=!1},c.GRID_SIZE=10,c}(f);b.RoutedConnectorViewModel=h;var i=function(a){function b(b,c){var d=this;a.call(this,b,c,null),this.template="dxdd-routed-connector",this.selectiontemplate="dxdd-routed-connector-selection",this.showArrow=ko.observable(!1),this.routePoints=ko.observableArray(),this.routePointsSet=ko.pureComputed(function(){var a=[];return d.routePoints().forEach(function(b){a.push(b.x()+" "+b.y())}),a.join(", ")}),this.routeLineWrappers=ko.pureComputed(function(){for(var a=[],b=1;b<d.routePoints().length;b++)a.push(d._createRouteLineWrapper(d.routePoints()[b-1],d.routePoints()[b],1===b||b===d.routePoints().length-1));return a}),this.startPoint=ko.pureComputed(function(){return new e(b.startPoint(),c)}),this.endPoint=ko.pureComputed(function(){return new e(b.endPoint(),c)}),this._disposables.push(b.routePoints.subscribe(function(){d._updateRoutePoints()})),this._updateRoutePoints()}return __extends(b,a),b.prototype._createRoutePoint=function(a,b){return{x:ko.pureComputed(function(){return Math.round(a.x()-b.x())}),y:ko.pureComputed(function(){return Math.round(a.y()-b.y())}),modelPoint:a}},b.prototype._createRouteLineWrapper=function(a,b,c){void 0===c&&(c=!1);var d=this,e=Math.abs(a.x.peek()-b.x.peek())<1,f=a.modelPoint.y.peek(),g=a.modelPoint.x.peek(),h={top:Math.min(a.y.peek(),b.y.peek())-4,left:Math.min(a.x.peek(),b.x.peek())-4,width:Math.abs(a.x.peek()-b.x.peek())+6,height:Math.abs(a.y.peek()-b.y.peek())+6},i=function(c){d._control.freezeRoute(!0);try{if(d._control.beginUpdate(),e){var h=g+c.delta.dx;a.modelPoint.x(h),b.modelPoint.x(h)}else{var i=f+c.delta.dy;a.modelPoint.y(i),b.modelPoint.y(i)}}finally{d._control.endUpdate()}};return{position:h,isVerticalLine:e,resizeHandler:i,resizeStopped:function(){d._control.routePoints.notifySubscribers()},isLocked:ko.observable(c)}},b.prototype._updateRoutePoints=function(){var a=this,b=[],c=this.getControlModel(),d=c.location;b.push(this._createRoutePoint(c.startPoint().location,d)),c.routePoints().forEach(function(c){b.push(a._createRoutePoint(c,d))}),b.push(this._createRoutePoint(c.endPoint().location,d)),this.routePoints(b)},b}(b.DiagramElementBaseSurface);b.RoutedConnectorSurface=i,ko.bindingHandlers.routeLineDraggable={init:function(b,c){var d=c(),e=$.extend({snap:".dxrd-drag-snap-line",snapTolerance:a.SnapLinesHelper.snapTolerance},ko.unwrap(d),{start:function(){d.starting()},stop:function(){d.stopped()},drag:function(a,b){var c=b.position.left-b.originalPosition.left,e=b.position.top-b.originalPosition.top;d.forceResize({delta:{dx:c,dy:e}})}});$(b).draggable(e)}}}(b=a.Diagram||(a.Diagram={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){var c;!function(c){var d=function(b){function d(c){var d=new a.JS.Utils.ModelSerializer;b.call(this,c,null,d),this.controlType="Diagram",this.controls=ko.observableArray(),this.name("Diagram")}return __extends(d,b),d.prototype.getInfo=function(){return c.diagramSerializationsInfo},d}(c.DiagramElementBaseViewModel);c.DiagramViewModel=d,c.margins={propertyName:"margins",modelName:"@Margins",from:b.Margins.fromString,displayName:"Margins"},c.pageWidth={propertyName:"pageWidth",modelName:"@PageWidth",defaultVal:850,from:b.floatFromModel,displayName:"Page Width",editor:a.JS.Widgets.editorTemplates.numeric},c.pageHeight={propertyName:"pageHeight",modelName:"@PageHeight",defaultVal:1250,from:b.floatFromModel,displayName:"Page Height",editor:a.JS.Widgets.editorTemplates.numeric},c.diagramSerializationsInfo=[c.name,c.pageWidth,c.pageHeight,c.margins];var e=function(a){function c(d,e){void 0===e&&(e=ko.observable(1)),a.call(this,d,{measureUnit:ko.observable("Pixels"),zoom:e,dpi:ko.observable(100)},c._unitProperties),this.measureUnit=ko.observable("Pixels"),this.dpi=ko.observable(100),this.controls=ko.observableArray(),this.allowMultiselect=!1,this.focused=ko.observable(!1),this.selected=ko.observable(!1),this.underCursor=ko.observable(new b.HoverInfo),this.parent=null,this.templateName="dx-diagram-surface",this.margins={bottom:this._bottom,left:this._left,right:this._right,top:this._top},this.zoom=e,this._context=this,b.createObservableArrayMapCollection(d.controls,this.controls,this._createSurface)}return __extends(c,a),c.prototype.checkParent=function(){return!1},c.prototype.getChildrenCollection=function(){return ko.observableArray([])},c._unitProperties={_width:function(a){return a.pageWidth},_height:function(a){return a.pageWidth},pageWidth:function(a){return a.pageWidth},pageHeight:function(a){return a.pageHeight},_bottom:function(a){return a.margins.bottom},_left:function(a){return a.margins.left},_right:function(a){return a.margins.right},_top:function(a){return a.margins.top}},c}(b.SurfaceElementBase);c.DiagramSurface=e}(c=b.Diagram||(b.Diagram={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(b,c,d,e,f){a.call(this,b,c,d,e),this.currentConnectionPoint=null,this.cursor="arrow",this.containment=".dxrd-ghost-container",this.helper=function(a){f.update(a)}}return __extends(c,a),c.prototype.startDrag=function(a){if(!(a instanceof b.ConnectionPointSurface))throw new Error("ConnectionPointDragHandler can be applied to the ConnectionPoint only.");this.currentConnectionPoint=a},c.prototype.drag=function(a,b){b.position.left+=b.scroll.left,b.position.top+=b.scroll.top;var c=this._getAbsoluteSurfacePosition(b);this.currentConnectionPoint.rect({top:c.top,left:c.left})},c.prototype.doStopDrag=function(){if(this.selection.dropTarget){var a=this.selection.dropTarget.getControlModel();if(a instanceof b.ConnectingPointViewModel){var c=this.currentConnectionPoint.parent.getControlModel();this.currentConnectionPoint.getControlModel()===c.startPoint()?c.startPoint().connectingPoint(a):c.endPoint().connectingPoint(a)}else if(a instanceof b.DiagramElementViewModel){var c=this.currentConnectionPoint.parent.getControlModel(),d=a.connectingPoints();this.currentConnectionPoint.getControlModel()===c.startPoint()?c.startPoint().connectingPoint(d[0]):c.endPoint().connectingPoint(d[0])}}},c}(a.DragDropHandler);b.ConnectionPointDragHandler=c;var d=function(c){function d(a,b,d,e,f){c.call(this,a,b,d,e),this.startConnectingPoint=null,this.newConnector=null,this.cursor="arrow",this.containment=".dxrd-ghost-container",this.helper=function(a){f.update(a)}}return __extends(d,c),d.prototype.startDrag=function(a){if(!(a instanceof b.ConnectingPointSurface))throw new Error("ConnectingPointDragHandler can be applied to the ConnectingPoint only.");this.startConnectingPoint=a;var c=this.startConnectingPoint.parent.getControlModel();this.newConnector=c.parentModel().createChild({"@ControlType":"RoutedConnector"}),this.newConnector.startPoint().connectingPoint(this.startConnectingPoint.getControlModel())},d.prototype.drag=function(a,b){b.position.left+=b.scroll.left,b.position.top+=b.scroll.top;var c=this._getAbsoluteSurfacePosition(b);this.newConnectorSurface.endPoint().rect({top:c.top,left:c.left})},d.prototype.doStopDrag=function(){if(this.selection.dropTarget){var a=this.selection.dropTarget.getControlModel();if(a instanceof b.ConnectingPointViewModel)this.newConnector.endPoint().connectingPoint(a);else if(a instanceof b.DiagramElementViewModel){var c=a.connectingPoints();this.newConnector.endPoint().connectingPoint(c[0])}this.selection.initialize(this.newConnectorSurface)}},Object.defineProperty(d.prototype,"newConnectorSurface",{get:function(){return this.newConnector&&a.findSurface(this.newConnector)},enumerable:!0,configurable:!0}),d}(a.DragDropHandler);b.ConnectingPointDragHandler=d}(b=a.Diagram||(a.Diagram={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){var c;!function(c){function d(){c.controlsFactory.registerControl("Unknown",{info:c.unknownSerializationsInfo,type:b.ElementViewModel,nonToolboxItem:!0,surfaceType:b.SurfaceElementBase}),c.controlsFactory.registerControl("Connector",{info:[c.name,{propertyName:"location",displayName:"Location",editor:a.JS.Widgets.editorTemplates.objecteditor},{propertyName:"startPoint",modelName:"@StartPoint",link:!0},{propertyName:"endPoint",modelName:"@EndPoint",link:!0}],surfaceType:c.ConnectorSurface,type:c.ConnectorViewModel,elementActionsTypes:[b.ElementActions],nonToolboxItem:!1}),c.controlsFactory.registerControl("RoutedConnector",{info:[c.name,{propertyName:"location",displayName:"Location",editor:a.JS.Widgets.editorTemplates.objecteditor},{propertyName:"startPoint",modelName:"@StartPoint",link:!0},{propertyName:"endPoint",modelName:"@EndPoint",link:!0}],surfaceType:c.RoutedConnectorSurface,type:c.RoutedConnectorViewModel,elementActionsTypes:[b.ElementActions],nonToolboxItem:!1}),c.controlsFactory.registerControl("ConnectionPoint",{info:c.connectionPointSerializationInfo,surfaceType:c.ConnectionPointSurface,type:c.ConnectionPointViewModel,elementActionsTypes:[],nonToolboxItem:!0}),c.controlsFactory.registerControl("Diagram",{info:c.diagramSerializationsInfo,surfaceType:c.DiagramSurface,popularProperties:["name"],type:c.DiagramViewModel,elementActionsTypes:[],isContainer:!0,nonToolboxItem:!0}),c.controlsFactory.registerControl("DiagramElement",{info:c.diagramElementSerializationInfo,defaultVal:{"@SizeF":"150,50",ConnectingPoints:{Item1:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"1","@PercentOffsetY":"0.5"},Item2:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"0.5","@PercentOffsetY":"1"},Item3:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"0.5","@PercentOffsetY":"0"},Item4:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"0","@PercentOffsetY":"0.5"}}},surfaceType:c.DiagramElementSurface,popularProperties:["text"],type:c.DiagramElementViewModel,elementActionsTypes:[b.ElementActions],nonToolboxItem:!1}),c.controlsFactory.registerControl("Ellipse",{info:c.diagramElementSerializationInfo,defaultVal:{"@SizeF":"150,50","@Type":"Ellipse",ConnectingPoints:{Item1:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"1","@PercentOffsetY":"0.5"},Item2:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"0.5","@PercentOffsetY":"1"},Item3:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"0.5","@PercentOffsetY":"0"},Item4:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"0","@PercentOffsetY":"0.5"}}},surfaceType:c.DiagramElementSurface,popularProperties:["text"],type:c.DiagramElementViewModel,elementActionsTypes:[b.ElementActions],nonToolboxItem:!1}),c.controlsFactory.registerControl("Condition",{info:c.diagramElementSerializationInfo,defaultVal:{"@SizeF":"150,50","@Type":"Condition",ConnectingPoints:{Item1:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"1","@PercentOffsetY":"0.5"},Item2:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"0.5","@PercentOffsetY":"1"},Item3:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"0.5","@PercentOffsetY":"0"},Item4:{"@ControlType":"ConnectingPoint","@PercentOffsetX":"0","@PercentOffsetY":"0.5"}}},surfaceType:c.DiagramElementSurface,popularProperties:["text"],type:c.DiagramElementViewModel,elementActionsTypes:[b.ElementActions],nonToolboxItem:!1}),c.controlsFactory.registerControl("ConnectingPoint",{info:c.connectingPointSerializationInfo,surfaceType:c.ConnectingPointSurface,type:c.ConnectingPointViewModel,elementActionsTypes:[],nonToolboxItem:!0})}function e(a,e,f){f&&Globalize.addCultureInfo("default",{messages:f}),d();var g=ko.pureComputed(function(){return new c.DiagramViewModel(e())}),h=ko.pureComputed(function(){var a=new c.DiagramSurface(g());return a}),i=b.createDesigner(g,h,c.controlsFactory,c.groups);i.connectionPointDragHandler=new c.ConnectionPointDragHandler(h,i.selection,i.undoEngine,i.snapHelper,i.dragHelperContent),i.connectingPointDragHandler=new c.ConnectingPointDragHandler(h,i.selection,i.undoEngine,i.snapHelper,i.dragHelperContent),i.isLoading(!1),i.selection.focused(h()),$(a).children().remove(),ko.applyBindings(i,a);var j=b.updateSurfaceContentSize(i.surfaceSize);return $(window).bind("resize",function(){j()}),i.tabPanel.width.subscribe(function(){j()}),j(),i}c.controlsFactory=new b.ControlsFactory,c.registerControls=d,c.groups={Appearance:[],Behavior:[],Design:[c.name],Layout:[c.location,c.size,c.pageWidth,c.pageHeight]},c.createDiagramDesigner=e}(c=b.Diagram||(b.Diagram={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(a){var b;!function(b){b.editorTemplates={bool:{header:"dx-boolean",custom:"dxqb-property-editor"},combobox:{header:"dx-combobox",custom:"dxqb-property-editor"},text:{header:"dx-text",custom:"dxqb-property-editor"},filterEditor:{header:"dxrd-filterstring",custom:"dxqb-property-editor"},numeric:{header:"dx-numeric",custom:"dxqb-property-editor"}},b.name={propertyName:"name",modelName:"@Name",displayName:"Name",disabled:!0,editor:b.editorTemplates.text},b.alias={propertyName:"alias",modelName:"@Alias",displayName:"Alias",defaultVal:null,editor:b.editorTemplates.text},b.text={propertyName:"text",modelName:"@Text",displayName:"Text",editor:b.editorTemplates.text},b.selected={propertyName:"selected",displayName:"Output",editor:b.editorTemplates.bool},b.size={propertyName:"size",modelName:"@Size",defaultVal:"100,125",from:a.Size.fromString},b.location={propertyName:"location",modelName:"@Location",from:a.Point.fromString},b.sizeLocation=[b.size,b.location],b.unknownSerializationsInfo=[b.name].concat(b.sizeLocation)}(b=a.QueryBuilder||(a.QueryBuilder={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(a){function b(a,b,c,d){var d=d||[];return a?(b.forEach(function(b){$.each(a[b]||[],function(a,b){d.push(c(b))})}),d):d}var c=function(){function a(a){var c=b(a.Tables,["DBTable","DBTableWithAlias"],function(a){return new d(a)});c.sort(function(a,b){return a.name.localeCompare(b.name)});var e=b(a.Views,["DBTable","DBTableWithAlias"],function(a){return new d(a)});e.sort(function(a,b){return a.name.localeCompare(b.name)}),this.tables=c.concat(e),this.procedures=b(a.Procedures,["DBStoredProcedure"],function(a){return new f(a)})}return a}();a.DBSchema=c;var d=function(){function a(a){this.name=a["@Name"],this.isView="true"===a["@IsView"]||a["@IsView"]===!0,this.columns=b(a.Columns,["DBColumn","DBColumnWithAlias"],function(a){return new h(a)}),this.foreignKeys=b(a.ForeignKeys,["DBForeignKey"],function(a){return new e(a)})}return a}();a.DBTable=d;var e=function(){function a(a){this.name=a["@Name"],this.primaryKeyTable=a["@PrimaryKeyTable"],this.column=a.Columns.string,this.primaryKeyColumn=a.PrimaryKeyTableKeyColumns.string}return a}();a.DBForeignKey=e;var f=function(){function a(a){this.name=a["@Name"],this.arguments=b(a.Arguments,["DBStoredProcedureArgument"],function(a){return new g(a)})}return a}();a.DBStoredProcedure=f;var g=function(){function a(a){this.name=a["@Name"],this.type=a["@Type"],this.direction=a["@Direction"]}return a.directions={"in":"In",out:"Out",inOut:"InOut"},a}();a.DBStoredProcedureArgument=g;var h=function(){function a(a){this.name=a["@Name"],this.type=a["@ColumnType"],this.size=a["@Size"]}return a.GetType=function(a){switch(a){case"Boolean":return"System.Boolean";case"Byte":return"System.Byte";case"SByte":return"System.SByte";case"Char":return"System.Char";case"Decimal":return"System.Decimal";case"Double":return"System.Double";case"Single":return"System.Single";case"Int32":return"System.Int32";case"UInt32":return"System.UInt32";case"Int16":return"System.Int16";case"UInt16":return"System.UInt16";case"Int64":return"System.Int64";case"UInt64":return"System.UInt64";case"String":return"System.String";case"DateTime":return"System.DateTime";case"Guid":return"System.Guid";case"TimeSpan":return"System.TimeSpan";case"ByteArray":return"System.Byte[]";default:return"System.Object"}},a}();a.DBColumn=h}(b=a.Data||(a.Data={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){function c(b,c,d){return $.post(a.Designer.QueryBuilder.HandlerUri,{actionKey:"getDBSchema",arg:encodeURIComponent(JSON.stringify({connectionString:this._connectionString(),dataSourceBase64:this._dataSource.base64(),tableName:d}))}).fail(function(b){a.Designer.NotifyAboutWarning("Schema loading failed. "+a.Designer.getErrorMessage(b),!0)})}b.getDBSchemaCallback=c;var d=function(a){function c(c,d){var e=this;void 0===d&&(d=b.getDBSchemaCallback),a.call(this),this._dataSource=c,this._getDBShcemaCallBack=d,this._tables={},this._connectionString=this._dataSource.connection.name,this._disposables.push(this._connectionString.subscribe(function(){e._tables={},e._dbSchema=null})),this.getItems=function(a){var b=$.Deferred();return a.fullPath?b.resolve([]):e.getDbSchema().done(function(a){b.resolve($.map(a.tables,function(a){var b={name:a.name,displayName:a.name,isList:!1,specifics:"list",dragData:{noDragable:!1}};return b}))}),b.promise()}}return __extends(c,a),c.prototype._getDBSchema=function(a){return this._getDBShcemaCallBack(this._connectionString(),this._dataSource.base64(),a)},c.prototype.getDbSchema=function(){if(!this._dbSchema){var a=$.Deferred();this._dbSchema=a.promise(),this._getDBSchema().done(function(c){a.resolve(new b.DBSchema(JSON.parse(c.result.dbSchemaJSON).DBSchema))}).fail(function(){a.reject()})}return this._dbSchema},c.prototype.getDbTable=function(a){if(!this._tables[a]){var c=$.Deferred();this._tables[a]=c.promise(),this._getDBSchema(a).done(function(a){var d=new b.DBSchema(JSON.parse(a.result.dbSchemaJSON).DBSchema);c.resolve(d.tables[0])}).fail(function(){c.reject()})}return this._tables[a]},c.prototype.dataSource=function(){return this._dataSource},c}(a.Designer.Disposable);b.DBSchemaProvider=d}(b=a.Data||(a.Data={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(a){var b;!function(b){function c(a,b){var c=null;return a.some(function(a){return b(a)&&(c=a),!!c}),c}var d=function(a){function c(b,c,d){a.call(this,b,c,d)}return __extends(c,a),c.prototype.getControlFactory=function(){return b.controlsFactory},c}(a.ElementViewModel);b.QueryElementBaseViewModel=d;var e=function(a){function b(c,d,e){a.call(this,c,d,$.extend({},b._unitProperties,e)),this.template="dx-diagram-element",this.selectiontemplate="dx-diagram-element-selection",this.contenttemplate="dx-diagram-element-content",this.isSnapTarget=!0,this.margin=ko.observable(0)}return __extends(b,a),b._unitProperties={_height:function(a){return a.size.height},_width:function(a){return a.size.width},_x:function(a){return a.location.x},_y:function(a){return a.location.y}},b}(a.SurfaceElementBase);b.QueryElementBaseSurface=e,b.findFirstItemMatchesCondition=c}(b=a.QueryBuilder||(a.QueryBuilder={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){var c;!function(c){c.joinType={propertyName:"joinType",modelName:"@Type",displayName:"Join Type",defaultVal:"Inner"},c.relationSerializationInfo=[{propertyName:"joinType",modelName:"@Type"},{propertyName:"parentTableName",modelName:"@Parent"},{propertyName:"nestedTableName",modelName:"@Nested"},{propertyName:"conditions",modelName:"KeyColumn",defaultVal:[],array:!0}];var d=function(b){function d(c,d,e){var g=this;b.call(this,$.extend(c,{"@ControlType":"Relation"}),d,e),this.parentTable=ko.observable(d.getTable(this.parentTableName.peek())),this.nestedTable=ko.observable(d.getTable(this.nestedTableName.peek())),this.parentTableName=ko.pureComputed(function(){return g.parentTable().actualName()}),this.nestedTableName=ko.pureComputed(function(){return g.nestedTable().actualName()}),this.conditions=a.JS.Utils.deserializeArray(c.KeyColumn,function(a){return new f(a,g,e)})}return __extends(d,b),d.prototype.getInfo=function(){return c.relationSerializationInfo},d.prototype.addChild=function(a){var b=a;this.conditions&&-1===this.conditions.indexOf(b)&&(b.parentModel(this),
this.conditions.push(b))},d.prototype.removeChild=function(a){var b=this.conditions().indexOf(a);b>-1&&this.conditions.splice(b,1),0===this.conditions().length&&this.parentModel().removeChild(this)},d}(c.QueryElementBaseViewModel);c.RelationViewModel=d;var e=function(a){function c(c,d){a.call(this,c,d,null),this.conditions=ko.observableArray(),this.template="dxqb-relation",b.createObservableArrayMapCollection(c.conditions,this.conditions,this._createSurface)}return __extends(c,a),c.prototype._getChildrenHolderName=function(){return"conditions"},c}(b.SurfaceElementBase);c.RelationSurface=e,c.ConditionType={Equal:"Equal",NotEqual:"NotEqual",Greater:"Greater",GreaterOrEqual:"GreaterOrEqual",Less:"Less",LessOrEqual:"LessOrEqual"},c.joinConditionSerializationInfo=[{propertyName:"left",displayName:"Left",editor:c.editorTemplates.text,disabled:!0},{propertyName:"right",displayName:"Right",editor:c.editorTemplates.text,disabled:!0},{propertyName:"parentColumnName",modelName:"@Parent"},{propertyName:"nestedColumnName",modelName:"@Nested"},{propertyName:"joinType",displayName:"Join Type",editor:c.editorTemplates.combobox,defaultVal:"Inner",values:{Inner:"Inner",LeftOuter:"Left Outer"}},{propertyName:"operator",modelName:"@Operator",displayName:"Operator",editor:c.editorTemplates.combobox,defaultVal:c.ConditionType.Equal,values:{Equal:"Equals to",NotEqual:"Does not equal to",Greater:"Is greater than",GreaterOrEqual:"Is greater than or equal to",Less:"Is less than",LessOrEqual:"Is less than or equal to"}}];var f=function(a){function d(c,d,e){var f=this;this.startPoint=ko.observable(),this.endPoint=ko.observable(),a.call(this,$.extend(c,{"@ControlType":"JoinCondition"}),d,e),this.parentColumn=ko.pureComputed(function(){return d.parentTable().getColumn(f.parentColumnName())}),this.nestedColumn=ko.pureComputed(function(){return d.nestedTable().getColumn(f.nestedColumnName())}),this.joinType=d.joinType,this.left=ko.pureComputed(function(){return d.parentTableName()+"."+f.parentColumnName()}),this.right=ko.pureComputed(function(){return d.nestedTableName()+"."+f.nestedColumnName()}),this._disposables.push(ko.computed(function(){if(f.parentColumn()&&f.nestedColumn()){var a=b.Diagram.determineConnectingPoints(f.parentColumn(),f.nestedColumn());f.startPoint().connectingPoint(a.start),f.endPoint().connectingPoint(a.end)}}))}return __extends(d,a),d.prototype.getControlFactory=function(){return c.controlsFactory},d}(b.Diagram.RoutedConnectorViewModel);c.JoinConditionViewModel=f;var g=function(a){function b(b,c){a.call(this,b,c),this.showArrow=ko.pureComputed(function(){return"LeftOuter"===b.joinType()})}return __extends(b,a),b}(b.Diagram.RoutedConnectorSurface);c.JoinConditionSurface=g}(c=b.QueryBuilder||(b.QueryBuilder={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(a){var b;!function(b){b.tableSerializationInfo=[b.name,b.alias,{propertyName:"selectedColumns",modelName:"Column",array:!0}];var c=function(c){function d(b,e,f){var g=this;c.call(this,b,e,f),this.size=new a.Size(135,123),this.location=new a.Point(0,0),this._columnsConnectionPointLeftX=ko.pureComputed(function(){return g.location.x()}),this._columnsConnectionPointRightX=ko.pureComputed(function(){return g.location.x()+g.size.width()}),this._columns=ko.observableArray(),this._initialized=ko.observable(!1),this.actualName=ko.pureComputed(function(){return g.alias()||g.name()}),this.selectedColumns=ko.observableArray(),this.allColumnsSelected=ko.pureComputed({read:function(){var a=g.selectedColumns();return 0===a.length?!1:a.length===g._columns.peek().length?!0:!1},deferEvaluation:!0}),this.isDisabled=ko.observable(!1),this.isInitialized=ko.pureComputed(function(){return g._initialized()}),this._retreiveDbTableProperties(b,f),this.size.height=ko.pureComputed({read:function(){return d.COLUMNS_OFFSET+(d.COLUMN_HEIGHT+d.COLUMN_MARGIN)*g._columns().length+4},write:function(){}}),this.controlType="Table"}return __extends(d,c),d.prototype._retreiveDbTableProperties=function(c,d){var e=this;this.parentModel().dbSchemaProvider.getDbTable(this.name()).done(function(f){var g=$.isPlainObject(c.Column)?$.map(c.Column,function(a){return a}):[];f.columns.forEach(function(f){var h=c.Column?a.getFirstItemByPropertyValue(g,"@Name",f.name):null,i=new b.ColumnViewModel(h||{"@Name":f.name},f,e,d);i.selected(!!h),e._columns.push(i)}),e._initialized(!0)})},d.prototype.columns=function(){return this._columns()},d.prototype.toggleSelectedColumns=function(){var a=!this.allColumnsSelected.peek();this._columns.peek().forEach(function(b){b.selected(a)})},d.prototype.getColumnConnectionPoints=function(a){var b=this,c=ko.pureComputed({read:function(){var c=b._columns.indexOf(a);return b.location.y()+d.COLUMNS_OFFSET+d.COLUMN_MARGIN*c+d.COLUMN_HEIGHT*(c+.5)},deferEvaluation:!0});return{left:{x:this._columnsConnectionPointLeftX,y:c},right:{x:this._columnsConnectionPointRightX,y:c}}},d.prototype.getInfo=function(){return b.tableSerializationInfo},d.prototype.getColumn=function(b){return a.getFirstItemByPropertyValue(this._columns(),"name",b)},d.COLUMNS_OFFSET=55,d.COLUMN_HEIGHT=20,d.COLUMN_MARGIN=3,d.TABLE_MIN_WIDTH=80,d}(b.QueryElementBaseViewModel);b.TableViewModel=c;var d=function(a){function c(c,d){var e=this;a.call(this,c,d,null),this.contenttemplate="dxqb-table",this.toggleSelected=function(){e.getControlModel().toggleSelectedColumns()},this.selectedWrapper=ko.pureComputed(function(){return e.getControlModel().allColumnsSelected()}),this.columns=ko.pureComputed(function(){return c.columns().map(function(a){return new b.ColumnSurface(a,d)})})}return __extends(c,a),c}(b.QueryElementBaseSurface);b.TableSurface=d}(b=a.QueryBuilder||(a.QueryBuilder={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){var c;!function(c){var d=function(b){function c(a,c,d,e){b.call(this,a,c,d,e)}return __extends(c,b),c.prototype._updateSpecifics=function(){var b=this;if(ko.unwrap(this.fieldListProvider)){var c=this.propertyName().split(".")[0];ko.unwrap(this.fieldListProvider).getItems(new a.JS.Widgets.PathRequest(c)).done(function(a){var c=a.filter(function(a){return a.name===b.propertyName()})[0];c&&b.specifics(c.specifics.toLowerCase())})}},c}(a.JS.Widgets.OperandPropertySurface);c.OperandPropertyQBSurface=d;var e=function(a){function b(c,d,e,f){var g=this;a.call(this,c,d,e,f),this.createParameter=function(){g.model.parameterName=g.parameterName(),ko.unwrap(g.fieldListProvider).createParameter(g.parameterName(),g.fieldsOptions()&&g.fieldsOptions().selected()&&g.fieldsOptions().selected().dataType||"System.String")},this._parameterName=ko.observable(""),this.isEditable=ko.observable(!1),this._parameterName(c.parameterName),this.fieldsOptions=d.leftPart.fieldsOptions,this.parameterName=ko.pureComputed({read:function(){return g._parameterName()||b.defaultDisplay},write:function(a){a!==b.defaultDisplay&&(g.model.parameterName=ko.unwrap(a),g._parameterName(g.model.parameterName))}})}return __extends(b,a),b.defaultDisplay="Create new parameter",b}(a.JS.Widgets.OperandParameterSurface);c.OperandParameterQBSurface=e;var f=function(){function b(b){this.getItems=function(a){var c=$.Deferred(),d=[];if(""===a.fullPath)d=b().tables().map(function(a){return{displayName:a.actualName(),name:a.actualName(),isList:!0,specifics:"Default",collapsed:ko.observable(!0)}});else{var e=b().tables().filter(function(b){return b.actualName()===a.fullPath})[0],f=e&&e.columns()||[];d=f.map(function(a){return{displayName:a.name.peek(),isList:!1,specifics:"string",dataType:a.dataType.peek(),name:e.actualName()+"."+a.name.peek()}})}return c.resolve(d),c.promise()},this.createParameter=function(c,d){if(""!==c&&c!==e.defaultDisplay&&0===b().parameters().filter(function(a){return a.name()===c}).length){var f=new a.Data.DataSourceParameter({"@Name":c,"@Type":d});b().parameters.push(f)}}}return b}();c.QBTablesProvider=f;var g=function(f){function g(b,g,h){var j=this;f.call(this,b,null,h),this._findAncestorsRelations=function(a){var b={inner:0,outer:0,relations:[]};return j.relations().forEach(function(c){if(c.nestedTable()===a){b.relations.push(c),"LeftOuter"===c.joinType()?b.outer++:b.inner++;var d=j._findAncestorsRelations(c.parentTable());b.inner+=d.inner,b.outer+=d.outer,b.relations.push.apply(b.relations,d.relations)}}),b},this.name()||this.name("Query"),this.type("TableQuery"),this.controlType="Query",this.dbSchemaProvider=g,this.filterString=new a.JS.Widgets.FilterStringOptions(this._filterString),this.orderBy=a.JS.Utils.deserializeArray(b.OrderBy,function(a){return new i(a,h)}),this.filterString.helper.handlers.changeParameter=function(b,c){return{data:new a.JS.Widgets.FilterEditorAddOn(b,c,"changeParameter","items","dxqb-filtereditor-parameterspopup"),templateName:"dxqb-filtereditor-changeparameter"}},this.filterString.helper.mapper.Parameter=e,this.filterString.helper.mapper.Property=d,this.filterString.helper.canCreateParameters=!0,this.filterString.helper.canSelectLists=!1,this.tables=a.JS.Utils.deserializeArray(b.Table,function(a){return new c.TableViewModel(a,j,h)}),this.tables().reduce(function(a,b){return b.location.x(a),b.location.y(65),a+b.size.width()+b.size.width()/2},30),this.relations=a.JS.Utils.deserializeArray(b.Relation,function(a){return new c.RelationViewModel(a,j,h)}),this.parameters=a.JS.Utils.deserializeArray(b.Parameter,function(b){return new a.Data.DataSourceParameter(b,h)}),this.filterString.helper.parameters=this.parameters,this.pageWidth=ko.pureComputed(function(){var a=500;return j.tables().forEach(function(b){var c=b.location.x()+b.size.width();c>a&&(a=c)}),a}),this.pageHeight=ko.pureComputed(function(){var a=500;return j.tables().forEach(function(b){var c=b.location.y()+b.size.height();c>a&&(a=c)}),a}),this.isValid=ko.pureComputed(function(){return j._validate()})}return __extends(g,f),g.prototype.getInfo=function(){return c.querySerializationsInfo},g.prototype.createChild=function(a){if("Table"!==a["@ControlType"])return f.prototype.createChild.call(this,a);var b=new c.TableViewModel(a,this);return this.addChild(b),b},g.prototype.tryToCreateRelationsByFK=function(a){var d=this;c.isJoinsResolvingDisabled||this.dbSchemaProvider.getDbSchema().done(function(c){var e=c.tables.filter(function(b){return b.name===a.name()})[0];e&&e.foreignKeys.forEach(function(c){var e=b.getFirstItemByPropertyValue(d.tables.peek(),"name",c.primaryKeyTable);if(e){var f=b.getFirstItemByPropertyValue(a.columns(),"name",c.column),g=b.getFirstItemByPropertyValue(e.columns(),"name",c.primaryKeyColumn);f&&g&&d.cerateJoinCondition(f,g)}}),d.tables.peek().forEach(function(e){var f=c.tables.filter(function(a){return a.name===e.name()})[0];f&&f.foreignKeys.forEach(function(c){if(c.primaryKeyTable===a.name()){var f=b.getFirstItemByPropertyValue(a.columns(),"name",c.primaryKeyColumn),g=b.getFirstItemByPropertyValue(e.columns(),"name",c.column);f&&g&&d.cerateJoinCondition(g,f)}})})})},g.prototype.addChild=function(a){if(a instanceof c.RelationViewModel){if(this.relations.indexOf(a)>-1)return;a.parentModel(this),this.relations.push(a)}else if(a instanceof c.TableViewModel){if(this.tables.indexOf(a)>-1)return;a.parentModel(this),null!==b.getFirstItemByPropertyValue(this.tables(),"actualName",a.name())&&a.alias(b.getUniqueName(this.tables().map(function(a){return a.actualName()}),a.name()+"_")),this.tables.push(a)}else b.NotifyAboutWarning("Attempt to add wrong child control.")},g.prototype.removeChild=function(a){if(a instanceof c.RelationViewModel){if(this.relations().length<1)return;this.relations.splice(this.relations().indexOf(a),1)}else if(a instanceof c.TableViewModel){if(this.tables().length<1)return;this.tables.splice(this.tables().indexOf(a),1);for(var d=this.relations(),e=d.length-1;e>-1;e--)(d[e].parentTable()===a||d[e].nestedTable()===a)&&this.removeChild(d[e]);for(var e=this.orderBy().length-1;e>-1;e--)this.orderBy()[e].table()===a.name()&&this.orderBy.remove(this.orderBy()[e]);for(var e=this.groupBy().length-1;e>-1;e--)this.groupBy()[e].table()===a.name()&&this.groupBy.remove(this.groupBy()[e])}else b.NotifyAboutWarning("Attempt to remove wrong child control.")},g.prototype.getTable=function(a){return b.getFirstItemByPropertyValue(this.tables(),"actualName",a)},g.prototype._findTableInAncestors=function(a,b){var c=this;return this.relations().some(function(d){return d.nestedTable()===a&&(d.parentTable()===b||c._findTableInAncestors(d.parentTable(),b))})},g.prototype._findHead=function(a){var b=null;return this.relations().some(function(c){return c.nestedTable()===a&&(b=c),!!b}),b?this._findHead(b.parentTable()):a},g.prototype._isHead=function(a){return!this.relations().some(function(b){return b.nestedTable()===a})},g.prototype._reverseRelations=function(a,b){b.forEach(function(a){var b=a.parentTable();a.parentTable(a.nestedTable()),a.nestedTable(b),a.conditions().forEach(function(a){var b=a.parentColumnName();a.parentColumnName(a.nestedColumnName()),a.nestedColumnName(b)})})},g.prototype.cerateJoinCondition=function(a,b){var d=a.parentModel(),e=b.parentModel();if(d===e)return null;var f=!1,g=c.findFirstItemMatchesCondition(this.relations(),function(a){return f=a.parentTable()===e&&a.nestedTable()===d,a.parentTable()===d&&a.nestedTable()===e||f});if(g);else if(this._findTableInAncestors(d,e))f=!0;else if(this._findHead(d)!==this._findHead(e)&&!this._isHead(e)){var h=this._findAncestorsRelations(d),i=this._findAncestorsRelations(e);h.outer>i.outer?this._reverseRelations(e,i.relations):h.outer<i.outer?(this._reverseRelations(d,h.relations),f=!0):h.inner>=i.inner?this._reverseRelations(e,i.relations):h.inner<i.inner&&(this._reverseRelations(d,h.relations),f=!0)}if(f){var j=d;d=e,e=j;var k=a;a=b,b=k}g=g||this.createChild({"@ControlType":"Relation","@Parent":d.actualName(),"@Nested":e.actualName(),"@Type":"Inner",KeyColumn:[]});var l=c.findFirstItemMatchesCondition(g.conditions(),function(c){return c.parentColumn()===a&&c.nestedColumn()===b});return l||(l=g.createChild({"@ControlType":"JoinCondition","@Parent":a.name(),"@Nested":b.name()})),l},g.prototype._validate=function(){if(0===this.tables().length)return!1;var a=this.tables().map(function(a){return a.actualName()});return this._validateTable(a,a[0]),a.length<1},g.prototype._validateTable=function(a,b){var c=this,d=a.indexOf(b);if(!(0>d)){a.splice(d,1);var e=this.relations().map(function(a){return a.parentTableName()===b?a.nestedTableName():a.nestedTableName()===b?a.parentTableName():null});e.forEach(function(b){return c._validateTable(a,b)})}},g.prototype.serialize=function(b){return void 0===b&&(b=!1),b?{Query:this.serialize()}:(new a.JS.Utils.ModelSerializer).serialize(this)},g.prototype.save=function(){var a=this.serialize(!0);return this.onSave&&this.onSave(a),a},g}(c.QueryElementBaseViewModel);c.QueryViewModel=g,c.margins={propertyName:"margins",modelName:"@Margins",from:b.Margins.fromString},c.querySerializationsInfo=[c.margins,{propertyName:"tables",modelName:"Table",array:!0},{propertyName:"relations",modelName:"Relation",array:!0},{propertyName:"parameters",modelName:"Parameter",array:!0},{propertyName:"type",modelName:"@Type"},{propertyName:"name",modelName:"@Name",displayName:"Name",editor:c.editorTemplates.text},{propertyName:"_filterString",modelName:"Filter",defaultVal:""},{propertyName:"filterString",defaultVal:"",displayName:"Filter",editor:c.editorTemplates.filterEditor},{propertyName:"orderBy",modelName:"OrderBy",array:!0},{propertyName:"groupBy",modelName:"GroupBy",array:!0,info:[{propertyName:"table",modelName:"@Table"},{propertyName:"column",modelName:"@Column"}]}];var h=function(a){function c(d,e){void 0===e&&(e=ko.observable(1)),a.call(this,d,{measureUnit:ko.observable("Pixels"),zoom:e,dpi:ko.observable(100)},c._unitProperties),this.tables=ko.observableArray(),this.relations=ko.observableArray(),this.allowMultiselect=!1,this.focused=ko.observable(!1),this.selected=ko.observable(!1),this.underCursor=ko.observable(new b.HoverInfo),this.templateName="dx-query-surface",this.measureUnit=this._context.measureUnit,this.dpi=this._context.dpi,this._context=this,this.margins={bottom:this._bottom,left:this._left,right:this._right,top:this._top},this.zoom=e,b.createObservableArrayMapCollection(d.tables,this.tables,this._createSurface),b.createObservableArrayMapCollection(d.relations,this.relations,this._createSurface)}return __extends(c,a),c.prototype.checkParent=function(){return!1},c.prototype.getChildrenCollection=function(){return this.tables},c._unitProperties={_width:function(a){return a.pageWidth},_height:function(a){return a.pageWidth},pageWidth:function(a){return a.pageWidth},pageHeight:function(a){return a.pageHeight},_bottom:function(a){return a.margins.bottom},_left:function(a){return a.margins.left},_right:function(a){return a.margins.right},_top:function(a){return a.margins.top}},c}(b.SurfaceElementBase);c.QuerySurface=h,c.orderByItemSerializationsInfo=[{propertyName:"table",modelName:"@Table"},{propertyName:"column",modelName:"@Column"},{propertyName:"descending",modelName:"@Descending",defaultVal:!1}];var i=function(){function b(b,c){c=c||new a.JS.Utils.ModelSerializer,c.deserialize(this,b)}return b.prototype.getInfo=function(){return c.orderByItemSerializationsInfo},b}();c.OrderByItem=i}(c=b.QueryBuilder||(b.QueryBuilder={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(a){var b;!function(b){var c=function(c){function d(a,b,d,e,f){c.call(this,a,b,d,e),this._dragColumn=null,this.dragDropConnector=ko.observable(null),this.cursor="arrow",this.containment=".dxrd-ghost-container",this.helper=function(a){f.update(a)}}return __extends(d,c),d.prototype._needToCreateRelation=function(){if(!(this.selection.dropTarget&&this.selection.dropTarget instanceof b.ColumnSurface))return!1;var a=this.selection.dropTarget.getControlModel().parentModel();return!a.isDisabled()},d.prototype.startDrag=function(c){if(!(c instanceof b.ColumnSurface))throw new Error("ColumnDragHandler can be applied to the Column only.");this._dragColumn=c;var d=new a.Diagram.RoutedConnectorViewModel({},this._dragColumn.getControlModel().root);this.dragDropConnector(new a.Diagram.RoutedConnectorSurface(d,this.surface()))},d.prototype.setConnectorPoints=function(b){var c=this._dragColumn.getControlModel(),d=this.dragDropConnector().getControlModel();if(this._needToCreateRelation()){var e=a.Diagram.determineConnectingPoints(c,this.selection.dropTarget.getControlModel());d.startPoint().connectingPoint(e.start),d.endPoint().connectingPoint(e.end)}else{var f=Math.abs(c.leftConnectionPoint.location.x()-b.left)>Math.abs(c.rightConnectionPoint.location.x()-b.left)?c.rightConnectionPoint:c.leftConnectionPoint;d.startPoint().connectingPoint(f),this.dragDropConnector().endPoint().rect({top:b.top,left:b.left})}},d.prototype.drag=function(a,b){b.position.left+=b.scroll.left,b.position.top+=b.scroll.top,this.setConnectorPoints(this._getAbsoluteSurfacePosition(b))},d.prototype.doStopDrag=function(){this.dragDropConnector(null);var b=this._dragColumn.getControlModel(),c=b.root;if(this._needToCreateRelation()){var e=this.selection.dropTarget.getControlModel(),f=c.cerateJoinCondition(b,e);null!==f&&this.selection.initialize(a.findSurface(c.cerateJoinCondition(b,e)))}d.resetTablesDisabledState(c)},d.prototype.dragColumn=function(){return this._dragColumn},d.setDisableStateForTables=function(a,b){if(b.isDisabled(!0),0!==a.relations().length){var c=[];a.relations().forEach(function(a){c.indexOf(a.parentTable)<0&&c.push(a.parentTable),c.indexOf(a.nestedTable)<0&&c.push(a.nestedTable)}),c.indexOf(b)>-1||a.tables().forEach(function(a){c.indexOf(a)<0&&a.isDisabled(!0)})}},d.resetTablesDisabledState=function(a){a.tables().forEach(function(a){a.isDisabled(!1)})},d}(a.DragDropHandler);b.ColumnDragHandler=c;var d=function(c){function d(d,e,f,g,h){var i=this;c.call(this,d,e,f,g),this._undoEngine=f,this._querySurface=d,this.cursor="arrow",this.containment=".dxrd-designer",this.cursorAt={top:0,left:0},this.helper=function(b){c.prototype.helper.call(i,b);b.data.isList?"List":b.data.specifics;i.recalculateSize(a.Size.fromString("135, 123")),h.setContent(new a.Rectangle(0,0,i._size.width(),i._size.height()))},this._drop=function(a,c){var d=c.createChild($.extend({"@ControlType":"Table","@Name":a.name},b.controlsFactory.controlsMap.Table.defaultVal));return d.isInitialized()?c.tryToCreateRelationsByFK(d):d.isInitialized.subscribe(function(){i._undoEngine().start(),c.tryToCreateRelationsByFK(d),i._undoEngine().end()}),d}}return __extends(d,c),d.prototype.doStopDrag=function(a,b){if(this._querySurface().underCursor()&&this._querySurface().underCursor().isOver){var c=this._getAbsoluteSurfacePosition(a);this._querySurface().underCursor().x=c.left-this._querySurface().absolutePosition.x(),this._querySurface().underCursor().y=c.top-this._querySurface().absolutePosition.y();var d=b,e=(b.data.isList?"List":b.data.specifics,this._drop(d.data,this._querySurface().getControlModel()));this.addControl(e,this._querySurface(),this._size)}},d.prototype.addControl=function(b,c,d){c.getControlModel().addChild(b);var e=a.findSurface(b);e.rect({left:c.underCursor().x,top:c.underCursor().y,width:d.width()}),this.selection.initialize(e)},d}(a.DragDropHandler);b.DbObjectDragDropHandler=d}(b=a.QueryBuilder||(a.QueryBuilder={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){var c;!function(c){function d(){b.Diagram.registerControls(),c.controlsFactory.registerControl("Unknown",{info:c.unknownSerializationsInfo,type:b.ElementViewModel,nonToolboxItem:!0,surfaceType:b.SurfaceElementBase,isDeleteDeny:!0}),c.controlsFactory.registerControl("Relation",{info:c.relationSerializationInfo,defaultVal:{},surfaceType:c.RelationSurface,popularProperties:[],type:c.RelationViewModel,elementActionsTypes:[],nonToolboxItem:!0}),c.controlsFactory.registerControl("JoinCondition",{info:c.joinConditionSerializationInfo,defaultVal:{},surfaceType:c.JoinConditionSurface,popularProperties:["_parentColumnName","_nestedColumnName","joinType"],type:c.JoinConditionViewModel,elementActionsTypes:[b.ElementActions],nonToolboxItem:!0}),c.controlsFactory.registerControl("Table",{info:c.tableSerializationInfo,defaultVal:{Column:[]},surfaceType:c.TableSurface,popularProperties:["name","alias","columns"],type:c.TableViewModel,elementActionsTypes:[b.ElementActions],nonToolboxItem:!0}),c.controlsFactory.registerControl("Column",{info:c.columnSerializationInfo,defaultVal:{},surfaceType:c.ColumnSurface,popularProperties:["name","alias","selected"],type:c.ColumnViewModel,elementActionsTypes:[b.ElementActions],nonToolboxItem:!0,isDeleteDeny:!0}),c.controlsFactory.registerControl("Query",{info:c.querySerializationsInfo,surfaceType:c.QuerySurface,popularProperties:["name","filterString"],type:c.QueryViewModel,elementActionsTypes:[b.ElementActions],isContainer:!0,nonToolboxItem:!0,isDeleteDeny:!0})}function e(a,b){var d=a.model;return function(e){var f=c.findFirstItemMatchesCondition(e,function(a){return"Delete"===a.text});f.imageClassName="dx-icon-dxrd-image-recycle-bin";var g=c.findFirstItemMatchesCondition(e,function(a){return"Undo"===a.text});g.disabled=ko.pureComputed(function(){return a.isLoading()||!a.undoEngine().undoEnabled()});var h=c.findFirstItemMatchesCondition(e,function(a){return"Redo"===a.text});e.splice(0,e.length,f,g,h),e.push({text:"Save",imageClassName:"dxqb-image-save",disabled:a.isLoading,visible:!0,hotKey:{ctrlKey:!0,keyCode:"S".charCodeAt(0)},clickAction:function(){d().save()},hasSeparator:!0}),e.push({text:"Preview Results",imageClassName:"dxrd-image-data-preview",disabled:a.isLoading,visible:!0,hotKey:{ctrlKey:!0,keyCode:"P".charCodeAt(0)},clickAction:function(){a.showPreview()},hasSeparator:!0}),b&&b(e)}}function f(a){return function(){var b=$(".dxqb-designer .dxrd-right-panel").outerWidth();$(".dxqb-designer .dxrd-surface-wrapper").css("right",b);var c=$(".dxqb-designer").width()-(b+5);$(".dxqb-designer .dxrd-surface-wrapper").css("width",c),a(c)}}function g(a,b){var c=ko.observable(!1);return b.subscribe(function(){c(!1)}),ko.pureComputed(function(){return b.peek().getDbSchema().done(function(){c(!0)}),c()?a().tables.peek().some(function(a){return!a.isInitialized()}):!0})}function h(a){var c={};$.each(a,function(a,d){c[b.localization_values[a]?b.localization_values[a]:a]=d}),Globalize.addCultureInfo("default",{messages:c})}function i(i,j,k,l){l&&Globalize.addCultureInfo("default",{messages:l}),d();var m=ko.observable(),n=ko.observable(),o=ko.observable();m.subscribe(function(a){n(new c.QuerySurface(a))});var p=function(a){var b=new c.QueryViewModel(a,j.dbSchemaProvider());b.filterString.helper.canChoiceParameters=!!j.parametersEditingEnabled,m(b),o({itemsProvider:j.dbSchemaProvider(),selectedPath:ko.observable()})};j.querySource.subscribe(function(a){p(a)}),p(j.querySource());var q=b.createDesigner(m,n,c.controlsFactory);q.rootStyle="dxqb-designer",q.dataPreview={isLoading:ko.observable(!1),isVisible:ko.observable(!1),data:ko.observable(),okButtonHandler:function(a){a.model.isVisible(!1)}},q.parts=[{templateName:"dxqb-toolbar",model:q},{templateName:"dxrd-surface-template-base",model:q},{templateName:"dx-right-panel-lightweight",model:q},{templateName:"dxqb-data-preview",model:q.dataPreview}],q.columnDragHandler=new c.ColumnDragHandler(n,q.selection,q.undoEngine,q.snapHelper,q.dragHelperContent),q.resizeHandler.handles="e, w";var r=ko.observable(0);q.tabPanel.tabs.length=0,q.tabPanel.tabs.push(new b.TabInfo("Properties","dxqb-properties-wrapper",{editableObject:q.editableObject,properties:new a.JS.Widgets.ObjectProperties(ko.pureComputed(function(){return q.selection.focused()&&q.selection.focused().getControlModel()}),null,1),fieldListModel:{treeListOptions:o},tablesTop:r})),q.fieldDragHandler=new c.DbObjectDragDropHandler(n,q.selection,q.undoEngine,q.snapHelper,q.dragHelperContent),q.dataBindingsProvider=q.fieldListProvider=new c.QBTablesProvider(m),q.isLoading=g(q.model,j.dbSchemaProvider),q.actionLists=new b.ActionLists(n,q.selection,q.undoEngine,e(q,k&&k.customizeActions)),q.selection.focused(n()),n.subscribe(function(a){q.selection.focused(a)}),q.isLoading()||q.undoEngine&&q.undoEngine().clearHistory(),q.isLoading.subscribe(function(){q.undoEngine&&q.undoEngine().clearHistory()}),q.selection.focused.subscribe(function(){r(null),r.notifySubscribers()}),i&&($(i).children().remove(),ko.cleanNode(i),ko.applyBindings(q,i));var s=f(q.surfaceSize);return $(window).bind("resize",function(){s()}),q.tabPanel.width.subscribe(function(){s()}),q.updateSurfaceSize=function(){s()},q.updateSurface=function(){s(),r(167)},q.updateSurface(),q.showPreview=function(){q.dataPreview.isLoading(!0),q.dataPreview.isVisible(!0),c.previewDataCallback(j.dbSchemaProvider().dataSource(),JSON.stringify(m().serialize(!0))).done(function(a){q.dataPreview.data(JSON.parse(a.result)),q.dataPreview.isLoading(!1)}).fail(function(a){q.dataPreview.isVisible(!1),b.ShowMessage(b.getErrorMessage(a)),b.NotifyAboutWarning(b.getErrorMessage(a))})},q.updateLocalization=h,q}c.controlsFactory=new b.ControlsFactory,c.registerControls=d,c.HandlerUri="DXQB.axd",c.previewDataCallback=function(a,c){return $.post(b.QueryBuilder.HandlerUri,{actionKey:"getDataPreview",arg:encodeURIComponent(JSON.stringify({connectionString:a.connection.name(),dataSourceBase64:a.base64(),sqlQueryJSON:c}))}).fail(function(){})},c.updateQueryBuilderSurfaceContentSize=f,c.createIsLoadingFlag=g,c.updateLocalization=h,c.isJoinsResolvingDisabled=!1,c.createQueryBuilder=i,ko.bindingHandlers.dxQueryBuilder={init:function(a,b){var c=$("#dxrd-querybuilder").text(),d=$(a).append(c);return ko.applyBindings(ko.unwrap(b()),d.children()[0]),{controlsDescendantBindings:!0}}},ko.bindingHandlers.dxdTableView={init:function(a,b){var c=$("#dxd-tableview").text(),d=$(a).append(c),e=ko.unwrap(b()),f=ko.observable(!1);ko.applyBindings({data:e,appendFakeRow:f},d.children()[0]);var g=d.find(".dxd-tableview-titles"),h=d.find(".dxd-tableview-data table");return f(d.height()>g.height()+h.height()),d.find(".dxd-tableview-titles .dxd-tableview-resizable").each(function(a,b){var c=$(b).find(".dxd-tableview-cell-text"),f=d.find(".dxd-tableview-data .dxd-tableview-resizable"+a);a<e.schema.length-1&&$(b).resizable({handles:"e",alsoResize:f.parent(),resize:function(a,b){c.outerWidth(b.size.width),f.outerWidth(b.size.width)}});var g=Math.max(c.width(),f.width());c.width(g),f.width(g)}),$(".dxd-tableview-data").dxScrollView({onScroll:function(a){a.scrollOffset.left>=0&&g.offset({left:h.offset().left,top:g.offset().top})}}),{controlsDescendantBindings:!0}}}}(c=b.QueryBuilder||(b.QueryBuilder={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){b.dsParameterNameValidationRules=[{type:"custom",validationCallback:function(a){return c.validateName(a.value)},message:a.Designer.getLocalization("Name is required and should be a valid identifier.")}],b.parameterValueSerializationsInfo={propertyName:"value",displayName:"Value",editor:a.JS.Widgets.editorTemplates.text},b.dsParameterSerializationInfo=[{propertyName:"_name",modelName:"@Name"},{propertyName:"name",displayName:"Name",validationRules:b.dsParameterNameValidationRules,editor:a.JS.Widgets.editorTemplates.text},{propertyName:"type",displayName:"Type",modelName:"@Type",editor:a.JS.Widgets.editorTemplates.combobox,values:{"System.String":"String","System.DateTime":"Date","System.Int16":"Number (16 bit integer)","System.Int32":"Number (32 bit integer)","System.Int64":"Number (64 bit integer)","System.Single":"Number (floating-point)","System.Double":"Number (double-precision floating-point)","System.Decimal":"Number (decimal)","System.Boolean":"Boolean","System.Guid":"Guid","DevExpress.DataAccess.Expression":"Expression"}},{propertyName:"_value",modelName:"Value"},b.parameterValueSerializationsInfo];var c=function(c){function d(e,f){var g=this;c.call(this),this._valueInfo=ko.observable(b.parameterValueSerializationsInfo),f=f||new a.JS.Utils.ModelSerializer,f.deserialize(this,e),this.name=ko.pureComputed({read:function(){return g._name()},write:function(a){d.validateName(a)&&g._name(a)}}),this._expressionValue=ko.observable({value:this._value}),this._disposables.push(this.type.subscribe(function(a){g._updateValueInfo(a)})),this.value=ko.pureComputed({read:function(){return"DevExpress.DataAccess.Expression"===g.type()?g._expressionValue():g._value()},write:function(a){g._value(a)}}),this._updateValueInfo(this.type.peek())}return __extends(d,c),d.prototype._getTypeValue=function(a){var b=d.typeValues.filter(function(b){return b.name===a});return b.length>0?b[0]:{name:a,defaultValue:null,specifics:"String",disableEditor:!0}},d.prototype._tryConvertValue=function(a,b){if(!d._isValueValid(a))return b.defaultValue;var c=b.valueConverter||function(a){return a},e=c(a);return d._isValueValid(a)?e:b.defaultValue},d._isValueValid=function(a){return void 0!==a&&null!==a&&!isNaN("string"==typeof a?"":a)},d.prototype._updateValueInfo=function(c){var d=this._getTypeValue(c);this.value(this._tryConvertValue(this._value(),d)),this._valueInfo($.extend({},b.parameterValueSerializationsInfo,{editor:a.Designer.getEditorType(d.name),disabled:d.disableEditor===!0}))},Object.defineProperty(d.prototype,"specifics",{get:function(){var a=this,b=d.typeValues.filter(function(b){return b.name===a.type()});return b.length>0?b[0].specifics:"string"},enumerable:!0,configurable:!0}),d.validateName=function(a){return a&&!a.match(/[~`!";%\^:\?*\(\)&\-\+={}\[\]\|\\\/,\.<>'\s]/)},d.prototype.getInfo=function(){if(this.type){var a=$.extend(!0,[],b.dsParameterSerializationInfo);return a.splice(a.indexOf(a.filter(function(a){return"value"===a.propertyName})[0]),1,this._valueInfo()),a}return b.dsParameterSerializationInfo},d.typeValues=[{name:"System.DateTime",defaultValue:new Date((new Date).setHours(0,0,0,0)),specifics:"Date",valueConverter:function(a){return Globalize.parseDate(a,["yyyy-MM-dd","MM/dd/yyyy HH:mm:ss"]);

}},{name:"System.String",defaultValue:"",specifics:"String"},{name:"System.SByte",defaultValue:0,specifics:"Integer",valueConverter:function(a){return parseInt(a)}},{name:"System.Int16",defaultValue:0,specifics:"Integer",valueConverter:function(a){return parseInt(a)}},{name:"System.Int32",defaultValue:0,specifics:"Integer",valueConverter:function(a){return parseInt(a)}},{name:"System.Int64",defaultValue:"0",specifics:"String"},{name:"System.Byte",defaultValue:0,specifics:"Integer",valueConverter:function(a){return parseInt(a)}},{name:"System.UInt16",defaultValue:0,specifics:"Integer",valueConverter:function(a){return parseInt(a)}},{name:"System.UInt32",defaultValue:0,specifics:"Integer",valueConverter:function(a){return parseInt(a)}},{name:"System.UInt64",defaultValue:"0",specifics:"String"},{name:"System.Decimal",defaultValue:"0",specifics:"String"},{name:"System.Double",defaultValue:0,specifics:"Float",valueConverter:function(a){return parseFloat(a)}},{name:"System.Single",defaultValue:0,specifics:"Float",valueConverter:function(a){return parseFloat(a)}},{name:"System.Boolean",defaultValue:!1,specifics:"Bool",valueConverter:function(a){return void 0!==a?"true"===String(a).toLowerCase():a}},{name:"System.Guid",defaultValue:"00000000-0000-0000-0000-000000000000",specifics:"String"},{name:"DevExpress.DataAccess.Expression",defaultValue:"",specifics:"String"},{name:"System.Char",defaultValue:"",specifics:"String"}],d}(a.Designer.Disposable);b.DataSourceParameter=c}(b=a.Data||(a.Data={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){var c=function(){function a(a,b,c,d){var e=this;this.showPopup=function(a){e._popupService.title(""),e._updateActions(e.target),e._popupService.target(a.element),e._popupService.visible(!0)},this.target=a,this._action=c,this._popupService=b,this._popupItems=d}return a.prototype._updateActions=function(a){var b=this;this._popupService.data({data:this._popupItems,template:"dx-filtereditor-popup-common",click:function(c){a[b._action](c),b._popupService.visible(!1)}})},a}();b.MasterDetailEditorPopupManager=c;var d=function(){function b(b,d){var f=this;this.isValid=ko.observable(!0),this.popupVisible=ko.observable(!1),this.loadPanelVisible=ko.observable(!1),this.buttonItems=[],this.masterQueries=ko.observableArray(),this.popupService=new a.Designer.PopupService,this.save=function(){var c=b.relations().some(function(a){return!a.detailQuery()||!a.masterQuery()||a.keyColumns().some(function(a){return!a.detailColumn()||!a.masterColumn()})});c?a.Designer.ShowMessage(a.Designer.getLocalization("Some fields are empty. Please fill all empty fields or remove the corresponding conditions to proceed.")):d().done(function(){f.popupVisible(!1)})},this.createRelation=function(a){var d=b.resultSet.tables().filter(function(b){return b.tableName()!==a.queryName}).map(function(a){return{name:a.tableName()}});return{data:new c(a,f.popupService,"create",d),templateName:"dx-filtereditor-create"}},this.setColumn=function(d){var e=a.Designer.getFirstItemByPropertyValue(b.resultSet.tables(),"tableName",d.queryName);return{data:new c(d,f.popupService,"setColumn",e?e.columns():[]),templateName:"dx-masterdetail-editor-setColumn"}},this._createMainPopupButtons();var g={};b.resultSet.tables().forEach(function(a){g[a.tableName()]=new e(a.tableName(),b.relations)}),b.relations().forEach(function(a){g[a.masterQuery()]=g[a.masterQuery()]||new e(a.masterQuery(),b.relations),g[a.masterQuery()].add(a)}),this.masterQueries($.map(g,function(a){return a}))}return b.prototype._createMainPopupButtons=function(){var a=this;this.buttonItems=[{toolbar:"bottom",location:"after",widget:"button",options:{text:"Save",onClick:function(){a.save()}}},{toolbar:"bottom",location:"after",widget:"button",options:{text:"Cancel",onClick:function(){a.popupVisible(!1)}}}]},b}();b.MasterDetailEditor=d;var e=function(){function c(c,d){var e=this;this.relations=ko.observableArray(),this.queryName=c,this.add=function(a){e.relations.push(new f(a,e))},this.create=function(c){var f=new b.MasterDetailRelation({"@Master":e.queryName,"@Detail":c.name});a.Designer.getFirstItemByPropertyValue(e.relations(),"relationName",f.name())&&f.name(a.Designer.getUniqueName(e.relations().map(function(a){return a.relationName()}),f.name()+"_")),f.keyColumns.push({masterColumn:ko.observable(),detailColumn:ko.observable()}),e.add(f),d.push(f)},this.remove=function(a){e.relations.remove(a),d.remove(function(b){return b.name===a.relationName})}}return c}();b.MasterQuerySurface=e;var f=function(){function a(a,b){var c=this;this.isEditable=ko.observable(!1),this.relationName=a.name,this.keyColumns=ko.pureComputed(function(){return a.keyColumns().map(function(b){return{master:new g(b.masterColumn,a.masterQuery()),detail:new g(b.detailColumn,a.detailQuery())}})}),this.create=function(){a.keyColumns.push({masterColumn:ko.observable(),detailColumn:ko.observable()})},this.remove=function(d){a.keyColumns.remove(function(a){return a.masterColumn===d.master.column&&a.detailColumn===d.detail.column}),0===a.keyColumns().length&&b.remove(c)}}return a}();b.MasterDetailRelationSurface=f;var g=function(){function a(a,b){var c=this;this.column=a,this.queryName=b,this.setColumn=function(a){c.column(a.name())}}return a}();b.KeyColumnSurface=g}(b=a.Data||(a.Data={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){var c=[{propertyName:"name",modelName:"@Name"},{propertyName:"tables",modelName:"View",array:!0}],d=function(){function b(b,c){c=c||new a.JS.Utils.ModelSerializer,c.deserialize(this,b),this.tables=a.JS.Utils.deserializeArray(b.View,function(a){return new f(a,c)})}return b.prototype.getInfo=function(){return c},b}();b.ResultSet=d;var e=[{propertyName:"tableName",modelName:"@Name"},{propertyName:"columns",modelName:"Field",array:!0,info:[{propertyName:"name",modelName:"@Name"},{propertyName:"propertyType",modelName:"@Type"}]}],f=function(){function b(b,c){c=c||new a.JS.Utils.ModelSerializer,c.deserialize(this,b)}return b.prototype.getInfo=function(){return e},b}();b.ResultTable=f}(b=a.Data||(a.Data={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){b.SqlQueryType={customSqlQuery:"CustomSqlQuery",tableQuery:"TableQuery",storedProcQuery:"StoredProcQuery"};var c=function(c){function d(d,e,f){var k=this;c.call(this),f=f||new a.JS.Utils.ModelSerializer,f.deserialize(this,d),this.base64=function(){return e},this.queries=a.JS.Utils.deserializeArray(d.Query,function(a){if(a["@Type"]===b.SqlQueryType.customSqlQuery)return new g(a,k,f);if(a["@Type"]===b.SqlQueryType.tableQuery)return new h(a,k,f);if(a["@Type"]===b.SqlQueryType.storedProcQuery)return new i(a,k,f);throw new Error("Unknown sql query type.")}),this.relations=a.JS.Utils.deserializeArray(d.Relation,function(a){return new j(a,f)}),this.dbSchemaProvider=new b.DBSchemaProvider(this),this._disposables.push(this.connection.name.subscribe(function(){k.queries([]),k.relations([]),k.resultSet=null}))}return __extends(d,c),d.prototype.getInfo=function(){return f},d}(a.Designer.Disposable);b.SqlDataSource=c;var d=function(){function b(b,c){this.name=ko.observable(),c=c||new a.JS.Utils.ModelSerializer,c.deserialize(this,b)}return b.from=function(a,c){return new b(a,c)},b.prototype.getInfo=function(){return e},b}();b.SqlDataSourceConnection=d;var e=[{propertyName:"name",modelName:"@Name"},{propertyName:"fromAppConfig",modelName:"@FromAppConfig",defaultVal:!1,from:a.Designer.parseBool}];b.masterDetailRelationSerializationsInfo=[{propertyName:"masterQuery",modelName:"@Master"},{propertyName:"detailQuery",modelName:"@Detail"},{propertyName:"_customName",modelName:"@Name"},{propertyName:"keyColumns",modelName:"KeyColumn",array:!0,info:[{propertyName:"masterColumn",modelName:"@Master"},{propertyName:"detailColumn",modelName:"@Detail"}]}];var f=[{propertyName:"name",modelName:"Name"},{propertyName:"connection",modelName:"Connection",from:d.from},{propertyName:"queries",modelName:"Query",array:!0},{propertyName:"relations",modelName:"Relation",array:!0},{propertyName:"resultSet",modelName:"ResultSchema",from:function(a,c){return a?new b.ResultSet(a.DataSet,c):null}}];b.customQuerySerializationsInfo=[{propertyName:"type",modelName:"@Type"},{propertyName:"name",modelName:"@Name"},{propertyName:"sqlString",modelName:"Sql",defaultVal:""},{propertyName:"parameters",modelName:"Parameter",array:!0}];var g=function(){function c(c,d,e){this.parent=d,(e||new a.JS.Utils.ModelSerializer).deserialize(this,c),this.name(this.name.peek()||"Query"),this.type=ko.pureComputed(function(){return b.SqlQueryType.customSqlQuery}),this.parameters=a.JS.Utils.deserializeArray(c.Parameter,function(a){return new b.DataSourceParameter(a,e)})}return c.prototype.getInfo=function(){return b.customQuerySerializationsInfo},c}();b.CustomSqlQuery=g,b.tableQuerySerializationsInfo=[{propertyName:"type",modelName:"@Type"},{propertyName:"name",modelName:"@Name",defaultVal:"TableQuery"},{propertyName:"parameters",modelName:"Parameter",array:!0},{propertyName:"filterString",modelName:"Filter",defaultVal:""}];var h=function(){function c(c,d,e){this.parent=d,(e||new a.JS.Utils.ModelSerializer).deserialize(this,c),this.type=ko.pureComputed(function(){return b.SqlQueryType.tableQuery}),this.parameters=a.JS.Utils.deserializeArray(c.Parameter,function(a){return new b.DataSourceParameter(a,e)})}return c.prototype.getInfo=function(){return b.tableQuerySerializationsInfo},c}();b.TableQuery=h,b.storedProcQuerySerializationsInfo=[{propertyName:"type",modelName:"@Type"},{propertyName:"name",modelName:"@Name"},{propertyName:"procName",modelName:"ProcName"},{propertyName:"parameters",modelName:"Parameter",array:!0}];var i=function(){function c(c,d,e){this.parent=d,(e||new a.JS.Utils.ModelSerializer).deserialize(this,c),this.type=ko.pureComputed(function(){return b.SqlQueryType.storedProcQuery}),this.parameters=a.JS.Utils.deserializeArray(c.Parameter,function(a){return new b.DataSourceParameter(a,e)})}return c.prototype.getInfo=function(){return b.storedProcQuerySerializationsInfo},c}();b.StoredProcQuery=i;var j=function(){function c(b,c){var d=this;this.name=ko.pureComputed({read:function(){return d._customName()||d.masterQuery()+d.detailQuery()},write:function(a){d._customName(a)},deferEvaluation:!0}),(c||new a.JS.Utils.ModelSerializer).deserialize(this,b)}return c.prototype.getInfo=function(){return b.masterDetailRelationSerializationsInfo},c}();b.MasterDetailRelation=j}(b=a.Data||(a.Data={}))}(DevExpress||(DevExpress={}));var DevExpress;!function(a){var b;!function(b){var c;!function(c){c.AggregationType={None:"None",Count:"Count",Max:"Max",Min:"Min",Avg:"Avg",Sum:"Sum"},c.columnSerializationInfo=[c.name,{propertyName:"displayType",displayName:"Type",disabled:!0,editor:c.editorTemplates.text},c.alias,c.selected,{propertyName:"sortingType",displayName:"Sort Type",editor:c.editorTemplates.combobox,defaultVal:"Unsorted",values:{Unsorted:"Unsorted",Ascending:"Ascending",Descending:"Descending"}},{propertyName:"sortOrder",displayName:"Sort Order",editor:c.editorTemplates.numeric},{propertyName:"groupBy",displayName:"Group By",editor:c.editorTemplates.bool,defaultVal:!1},{propertyName:"aggregate",modelName:"@Aggregate",displayName:"Aggregate",editor:c.editorTemplates.combobox,values:c.AggregationType,defaultVal:c.AggregationType.None}];var d=function(b){function d(d,e,f,g){var h=this;b.call(this,$.extend({"@ControlType":"Column"},d),f,g),this.displayType=ko.pureComputed(function(){return e.type+(e.size?"("+e.size+")":"")}),this.dataType=ko.pureComputed(function(){return a.Data.DBColumn.GetType(e.type)}),this.actualName=ko.pureComputed(function(){return h.alias()||h.name()});var i=f.getColumnConnectionPoints(this);this.rightConnectionPoint={side:ko.observable(0),location:i.right},this.leftConnectionPoint={side:ko.observable(3),location:i.left};var j=f.parentModel().orderBy,k=ko.computed(function(){return c.findFirstItemMatchesCondition(j(),function(a){return a.table()===f.name()&&a.column()===h.name()})});this.sortingType=ko.computed({read:function(){return k()?k().descending()?"Descending":"Ascending":"Unsorted"},write:function(a){"Unsorted"!==a?k()?k().descending("Descending"===a):j.push(new c.OrderByItem({"@Table":f.name(),"@Column":h.name(),"@Descending":"Descending"===a})):k()&&j.remove(k())}}),this.sortOrder=ko.computed({read:function(){var a=j().indexOf(k());return 0>a?void 0:a+1},write:function(a){if(k()){a=Math.min(a,j().length),a=Math.max(a,1);var b=j().indexOf(k()),c=j.splice(b,1);j.splice(a-1,0,c[0])}}});var l=f.parentModel().groupBy,m=ko.computed(function(){return c.findFirstItemMatchesCondition(l(),function(a){return a.table()===f.name()&&a.column()===h.name()})});this.aggregate.subscribe(function(a){a!==c.AggregationType.None?(h.groupBy(!1),(!h.alias()||h._isAliasAutoGenerated())&&h.alias(h.name()+"_"+a)):h._isAliasAutoGenerated()&&h.alias(null)}),this.groupBy=ko.computed({read:function(){return!!m()},write:function(a){a?(l.push({table:ko.observable(f.name()),column:ko.observable(h.name())}),h.aggregate(c.AggregationType.None)):l.remove(m())}});var n=ko.pureComputed(function(){return f.selectedColumns.indexOf(h)>=0});this.selected=ko.pureComputed({read:function(){return n()},write:function(a){n()!==a&&(a?f.selectedColumns.push(h):f.selectedColumns.remove(h))}})}return __extends(d,b),d.prototype._isAliasAutoGenerated=function(){if(!this.alias()||0!==this.alias().indexOf(this.name()+"_"))return!1;var a=this.alias().substring(this.name().length+1);return Object.keys(c.AggregationType).indexOf(a)>0},d.prototype.getInfo=function(){return c.columnSerializationInfo},d.prototype.isPropertyDisabled=function(a){return"sortOrder"===a?"Unsorted"===this.sortingType():"aggregate"===a?!this.selected():void 0},d}(c.QueryElementBaseViewModel);c.ColumnViewModel=d;var e=function(a){function b(b,d){var e=this;a.call(this,b,d,null),this.template="dxqb-table-field",this.toggleSelected=function(){e.getControlModel().selected(!e.getControlModel().selected())},this.selectedWrapper=ko.pureComputed(function(){return e.getControlModel().selected()}),this.isAggregate=ko.pureComputed(function(){return e.getControlModel().aggregate()!==c.AggregationType.None}),this.isAscending=ko.pureComputed(function(){return"Ascending"===e.getControlModel().sortingType()}),this.isDescending=ko.pureComputed(function(){return"Descending"===e.getControlModel().sortingType()})}return __extends(b,a),b}(b.SurfaceElementBase);c.ColumnSurface=e}(c=b.QueryBuilder||(b.QueryBuilder={}))}(b=a.Designer||(a.Designer={}))}(DevExpress||(DevExpress={}));