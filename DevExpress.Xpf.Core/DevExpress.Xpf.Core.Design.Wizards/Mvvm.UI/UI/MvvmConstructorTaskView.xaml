<UserControl x:Class="DevExpress.Design.Mvvm.Wizards.UI.MvvmConstructorTaskView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="clr-namespace:DevExpress.Design.UI;assembly=DevExpress.Design.v15.2"
    xmlns:dataAccessUI="clr-namespace:DevExpress.Design.DataAccess.UI"
    xmlns:mvvmUI="clr-namespace:DevExpress.Design.Mvvm.Wizards.UI"
    Margin="0,0,0,8"
    >
    <UserControl.Resources>
        <ui:BooleanToVisibilityConverter x:Key="ButtonsVisibilityConverter"/>        
        <DataTemplate DataType="{x:Type mvvmUI:ConstructorStartPageViewModel}">
            <mvvmUI:ConstructorStartPageView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type mvvmUI:TablesSelectorViewModel}">
            <mvvmUI:TablesSelectorView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type mvvmUI:ViewModelEntityDefinitionsViewModel}">
            <mvvmUI:ViewModelEntityDefinitionsView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type mvvmUI:ViewModelSelectorPageModel}">
            <mvvmUI:ViewModelSelectorPage />
        </DataTemplate>
        <DataTemplate DataType="{x:Type mvvmUI:TabbedMDIViewModel}">
            <mvvmUI:TablesSelectorView />
        </DataTemplate>
        <DataTemplate x:Key="TabItemTemplate">
            <TextBlock FontSize="14" Text="{Binding Path=StepDescription}"></TextBlock>
        </DataTemplate>
        <SolidColorBrush x:Key="StepsLineItemNormalBackground" Color="#3D3D3D"/>
        <Style x:Key="StepsLineItemStyle" TargetType ="{x:Type ListBoxItem}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Background" Value="{StaticResource ResourceKey=StepsLineItemNormalBackground}"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ListBoxItem}">
                        <Grid SnapsToDevicePixels="true">
                            <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" Margin="0,0,1,0">
                                <ContentPresenter x:Name="Content" HorizontalAlignment="Center" RecognizesAccessKey="True" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="Center"/>
                            </Border>                            
                        </Grid>                        
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=IsEnabled}" Value="False">
                    <Setter Property="Background" Value="{StaticResource ResourceKey={ui:ThemeColorsKey Key=ColorSilverLight}}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Path=IsActive}" Value="True">
                    <Setter Property="Background" Value="{StaticResource ResourceKey={ui:ThemeColorsKey Key=ColorOrange}}"/>
                </DataTrigger>                
            </Style.Triggers>            
        </Style>
        <DataTemplate x:Key="StepsLineItemTemplate">
            <TextBlock Text="{Binding Name}" IsEnabled="{Binding IsEnabled}" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"/>
        </DataTemplate>
        <Style x:Key="TabControlWithoutHeader" TargetType="{x:Type TabControl}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TabControl}">
                        <Grid KeyboardNavigation.TabNavigation="Local">
                            <ContentPresenter Margin="{TemplateBinding Padding}" Content="{TemplateBinding SelectedItem}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="ui:TabControlBehavior.CtrlTabNavigation" Value="Ignore"/>
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <DockPanel>
            <ListBox DockPanel.Dock="Top" ItemsSource="{Binding StepsLineItems}" 
                     ItemTemplate="{StaticResource ResourceKey=StepsLineItemTemplate}"
                     ItemContainerStyle="{StaticResource ResourceKey=StepsLineItemStyle}"
                     BorderBrush="{x:Null}" BorderThickness="0" Margin="0,0,0,4"> 
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ListBox}, Path=Items.Count}"/>
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>                
            </ListBox>
            <TabControl 
                Style="{StaticResource TabControlWithoutHeader}"
                ItemsSource="{Binding Pages}" IsSynchronizedWithCurrentItem="True"
                SelectedIndex="{Binding SelectedIndex}"
                ItemTemplate="{StaticResource TabItemTemplate}" >
            </TabControl>
        </DockPanel>
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
            <Button Content="Back"
                    Style="{DynamicResource ResourceKey={ui:ControlsThemeKey Key=NavigationButton}}" 
                    Visibility="{Binding IsPrevPageAvailable, Converter={StaticResource ButtonsVisibilityConverter}}"
                    Command="{Binding PrevPageCommand}" CommandParameter="{Binding SelectedPage}"/>
            <Button Content="Next"
                    Style="{DynamicResource ResourceKey={ui:ControlsThemeKey Key=NavigationButton}}" 
                    Visibility="{Binding IsNextPageAvailable, Converter={StaticResource ButtonsVisibilityConverter}}"
                    Command="{Binding NextPageCommand}" CommandParameter="{Binding SelectedPage}"/>
            <Button Content="Finish"
                    Style="{DynamicResource ResourceKey={ui:ControlsThemeKey Key=NavigationButton}}"
                    Visibility="{Binding IsFinishAvailable, Converter={StaticResource ButtonsVisibilityConverter}}"
                    Command="{Binding FinishCommand}" CommandParameter="{Binding SelectedPage}"/>
        </StackPanel>
    </Grid>
</UserControl>
